var m={"template.dev":"/template.dev","innosoon.online":"/innosoon.online","jori.dev":"/jori.dev","paskahousu.online":"/paskahousu.online","kilpailuta.online":"/kilpailuta.online"},b={"/message":async(t,s)=>{let{default:n}=await import("./message-ZMPFXC35.js");return n(t,s)},"/random":async(t,s)=>{let{default:n}=await import("./random-NKU6FIGJ.js");return n(t,s)}},u=class{constructor(s){this.nonce=s}element(s){s.setAttribute("nonce",this.nonce)}},C={async fetch(t,s){try{let n=new URL(t.url),e=t.headers.get("host")||n.hostname,a=m[e]||"",o=n.pathname,l=b[o];if(l){let c=await l(t,s);return d(c,t,{})}let h=[];!o.includes(".")&&!o.endsWith("/")&&h.push(`${o}.html`),o.endsWith("/")&&h.push(`${o}index.html`),h.push(o);let i,f=new URL(t.url);for(let c of h){f.pathname=`${a}${c}`;let r=await s.ASSETS.fetch(f,t);if(r.status<400){i=r;break}}if(!i||i.status>=400)throw new Error("asset not found");if((i.headers.get("Content-Type")||"").includes("text/html")){let c=crypto.getRandomValues(new Uint8Array(16)),r=Array.from(c).map(g=>g.toString(16).padStart(2,"0")).join(""),y=["default-src 'self' https: blob:","frame-src   'self' https: blob:","media-src   'self' data: https:",`script-src  'self' 'nonce-${r}' https: blob:`,`style-src   'self' 'nonce-${r}' https:`,"img-src     'self' data: https:","font-src    'self' https:","object-src  'none'","base-uri    'self'"].join("; "),p=new HTMLRewriter().on("script",new u(r)).on("style",new u(r)).transform(i),w=new Response(p.body,{status:p.status,headers:p.headers});return d(w,t,{"Content-Security-Policy":y})}return d(i,t,{})}catch{let e=await s.ASSETS.fetch(new URL("/SHARED/Pages/404.html",t.url),t),a=new Response(e.body,{status:404,statusText:"Not Found",headers:e.headers});return d(a,t,{})}}};function d(t,s,n){let e=new Headers(t.headers),a=s.headers.get("Origin"),o=new Set(Object.keys(m));if(a)try{let{hostname:l}=new URL(a);o.has(l)&&(e.set("Access-Control-Allow-Origin",a),e.set("Access-Control-Allow-Credentials","true"))}catch{}return e.set("X-Robots-Tag","noindex"),e.set("X-UA-Compatible","IE=edge"),e.set("X-Content-Type-Options","nosniff"),e.set("Referrer-Policy","strict-origin-when-cross-origin"),e.set("Strict-Transport-Security","max-age=31536000; includeSubDomains; preload"),e.set("Cache-Control","public, max-age=31536000"),e.set("X-Page-Rule","Cache Everything"),e.set("X-Failover","Automatic"),e.set("X-Frame-Options","DENY"),e.set("Cross-Origin-Opener-Policy","same-origin"),e.set("Cross-Origin-Embedder-Policy","require-corp"),n["Content-Security-Policy"]&&e.set("Content-Security-Policy",n["Content-Security-Policy"]),new Response(t.body,{status:t.status,statusText:t.statusText,headers:e})}export{C as default};
